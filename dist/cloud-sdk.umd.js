/* @author Navicstein Rotciv <https://twitter.com/navicsteinR> 
*/(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):(a=a||self,a.cloud=b())})(this,function(){'use strict';function a(a){return localStorage.setItem(g,JSON.stringify(a))}function b(a=g){var b=localStorage.getItem(g);return!d.isUndefined(b)&&b}function c(b){let c=new URL(b.baseUrl).origin;fetch(c.concat("/__cloud/actions"),{method:"PATCH"}).then(a=>200===a.status?a.json():a.text().then(b=>a.ok?b:Promise.reject({status:a.status,data:b}))).then(b=>a(b)).catch(a=>f.panic(a))}const d={formateBaseUrl(a){return a.replace(/^\.*/,"").toLowerCase()},isArray(a){return"[object Array]"===toString.call(a)},isFormData(a){return"undefined"!=typeof FormData&&a instanceof FormData},isString(a){return"string"==typeof a},isNumber(a){return"number"==typeof a},isUndefined(a){return"undefined"==typeof a},isObject(a){return null!==a&&"object"==typeof a},isFunction(a){return"[object Function]"===toString.call(a)},isURLSearchParams(a){return"undefined"!=typeof URLSearchParams&&a instanceof URLSearchParams},serializeArgins(a){var b=[];for(let c in a)b.push(`${c}=${a[c]}`);return b=b.join("&"),b=encodeURI(b),"?".concat(b)},trim(a){return a.replace(/^\s*/,"").replace(/\s*$/,"")},isStandardBrowserEnv(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document}},f={panic(a){console.error(`%c Cloud %c  error  %c \n\n ${a}`,"background:blue ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff",`background: red; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff`,"background:transparent")},warn(a){console.warn(`%c Cloud %c  warn  %c ${a}`,"background:blue ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff",`background: #ff9800; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff`,"background:#ffeb3b5c;padding: 3px;color: #FF5722")},verbose(a){if(!d.isStandardBrowserEnv())return console.log(a)}};let g="cloud";var h=new Map,i=void 0;const j=function(a,b){if(d.isUndefined(a))return f.warn("`cloud('example') where `example` is the name of an action.`");if(!d.isString(a)||d.isArray(a)||d.isObject(a))return f.panic(`'${a}' is not a valid action name`);if(!h.has(a)){let b;for(let c of h.keys())!c.match(a)||(b=c);return f.panic(`\`${a}\` does not exist in your actions defintion, please check \`${i}/__cloud\` for the correct action.`),void(d.isUndefined(b)||f.warn(`Do you mean ${b}?`))}a=h.get(a);var c=i.concat(a.url);return /get/i.test(a.verb)&&!d.isUndefined(b)&&(c+="/".concat(d.serializeArgins(b))),fetch(c,{method:a.verb,body:"GET"==a.verb?null:JSON.stringify(b)}).then(a=>a.json().then(b=>a.ok?b:Promise.reject({status:a.status,data:b}))).then(a=>Promise.resolve(a)).catch(a=>Promise.reject(a.data))};return j.actions=()=>h,j.setup=function(a){function e(a){if(!d.isUndefined(a))for(let b in a)h.set(b,a[b])}if(a=a||{},i=new URL(a.baseUrl).origin,d.isUndefined(a.baseUrl)&&f.panic("Could not `.setup` cloudsdk because `baseUrl` is not defined"),d.isString(a.baseUrl)||f.panic(`'${a.baseUrl}' is not a valid baseUrl`),!b())c(a);else{let d=JSON.parse(b());e(d),c(a)}},j});
